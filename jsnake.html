<!DOCTYPE HTML>
<style type="text/css">

body {
	line-height: 1;
	color: black;
	background: #f2f2f2;
}
table {
	border-collapse: separate;
	border-spacing: 1px;
}
table#grid {
	margin: 0;
	padding: 0;
	height: 10cm;
	width: 16cm; 
}
td {
	text-align: left;
	font-weight: normal;
	width: 10px;
	height: 10px;
	margin: 0;
	padding: 0;
}
td.ground {
	background: #a0a0a0;
}
td.snake {
	background: #6ECF4D;
}
td.food {
	background: #ff5555;
}
td.playunselected {
	background: #6ECF4D;
}
td.playselected {
	background: #ff5555;
}
</style>
<script type="text/javascript">
//dimensions of grid
var gridXdim = 32;
var gridYdim = 20;
//game speed
var speed = 400;
//snake variables
var dir, len, newX, newY, snakeX, snakeY;
//dir -> 0,1,2,3 = left, up, right, down
dir = 0;
//Array for locations for Play button pieces (one per line)
var play = new Array(
	"4-4","4-5","4-6","4-7","4-8","5-4","5-6","6-5", //P
	"8-4","8-5","8-6","8-7","8-8", "9-8", "10-8",	 //L
	"12-5","12-6","12-7","12-8","13-4","13-6","14-5","14-6","14-7","14-8", //A
	 "16-4","16-5","18-4","18-5","17-6","17-7","17-8" //Y
	 );
var playselected = false;
var tid;


//make grid on load
/*addLoadEvent(initGrid);
addLoadEvent(makeSnake);
addLoadEvent(makeFood);
addLoadEvent(function() {
	swipe = new Array(); //x1, y1, x2, y2
	for( iter = 0; iter < 4; iter++) {
		swipe[iter] = 0;
	}
});*/
window.onload = function() {

	document.onkeydown = function(e){
		switch(e.keyCode) {
			case 37: //left arrow
				if(dir != 2) dir = 0;
				break;
			case 38: //up arrow
				if(dir != 3) dir = 1;
				break;
			case 39: //right arrow
				if(dir != 0) dir = 2;
				break;
			case 40: //down arrow
				if(dir != 1) dir = 3;
				break;
		}
	};

	initGrid();
	initMenu();
}

function togglePlay() {
	playselected = !playselected;
	setPlay();
}

function setPlay() {
	var newClass = "playunselected";
	if(playselected) {
		newClass = "playselected";
	}
	for(iter =0; iter < play.length; iter++) {
		setGrid(play[iter], newClass);
	}
}

function initMenu() {
	//set colors
	setPlay();

	//setup highlighting and playing
	for(iter =0; iter < play.length; iter++) {
		//console.log(play[iter]);
		var item = document.getElementById(play[iter]);
		item.setAttribute("onmousedown","beginPlay();");
		item.setAttribute("onmouseover","togglePlay();");
		item.setAttribute("onmouseout","togglePlay();");
	}
}

//starts the timer, makes the snake and makes a food
function beginPlay() {
	for(iter =0; iter < play.length; iter++) {
		var item = document.getElementById(play[iter]);
		item.setAttribute("class", 'ground');
		item.removeAttribute("onmousedown");
		item.removeAttribute("onmouseover");
		item.removeAttribute("onmouseout");
	}

	tid = setTimeout(update, speed);

	makeSnake();
	makeFood();
}

//utility function to give a class to a grid member
function setGrid(locID, newClass) {
	var item = document.getElementById(locID);
	item.setAttribute("class", newClass);
}


function initGrid() {
	var elem = document.getElementById("grid");
	var row;
	var col;
	for( y = 0; y < gridYdim; y++) {
		row = document.createElement('tr');
		elem.appendChild(row);
		for( x = 0; x < gridXdim; x++) {
			col = document.createElement('td');
			col.setAttribute("id", x+"-"+y);
			col.setAttribute("class", 'ground');
			row.appendChild(col);
		}
	}
	
	/*
	elem.onmousedown = swipeBeg;
	elem.onmouseup = swipeEnd;
	elem.ontouchstart = swipeBeg;
	elem.ontouchend = swipeEnd;
	*/
	window.ondevicemotion = function(event) {
		var accX = event.accelerationIncludingGravity.x;
		var accY = event.accelerationIncludingGravity.y;
		
		if(Math.abs(accX) > 10) {
			if(accX < 0) {
				
			} else {
			
			}
		} else if(Math.abs(accY) > 10) {
			if(accY < 0) {
			
			} else {
			
			}
		}
	}
}

//sets up the snake and his body
function makeSnake() {
	//init vars
	dir = 0;
	snakeX=new Array();
	snakeY=new Array();

	//find random and fair placing (not too close to an edge)
	var Xrange = (gridXdim-10)/2+1;
	var Yrange = gridYdim/2+1;
	var firstX = Math.floor((Math.random()*Xrange) + Xrange/2);
	var firstY = Math.floor((Math.random()*Yrange) + Yrange/2);

	//setup body
	len = 5;
	for( iter = 0; iter < len; iter++) {
		snakeX[iter] = firstX + iter;
		snakeY[iter] = firstY;
		setGrid(snakeX[iter]+'-'+firstY, 'snake');
	}
}

//creates a food item at a random place on the board
function makeFood() {
	//choose a position
	var foodX = Math.floor(Math.random()*gridXdim);
	var foodY = Math.floor(Math.random()*gridYdim);

	//ensure the position is a valid position (so we don't turn part of the snake into food)
	while(document.getElementById(foodX+'-'+foodY).getAttribute('class') != 'ground') {
		foodX = Math.floor(Math.random()*gridXdim);
		foodY = Math.floor(Math.random()*gridYdim);
	}

	//set the position to food
	setGrid(foodX+'-'+foodY, 'food');
}

//called at intervals to update game
function update() {
	//find the next grid member to be a snake
	switch(dir) {
		case 0:
			newX = snakeX[0] - 1;
			newY = snakeY[0];
			break;
		case 1:
			newX = snakeX[0];
			newY = snakeY[0] - 1;
			break;
		case 2:
			newX = snakeX[0] + 1;
			newY = snakeY[0];
			break;
		case 3:
			newX = snakeX[0];
			newY = snakeY[0] + 1;
			break;
		default:
			alert('illegal direction');
	}
	
	//set grid to snake
	var newLocClass = document.getElementById(newX+'-'+newY).getAttribute('class');

	//test new position
	if(newX < 0 || newX > gridXdim || newY < 0 || newY > gridYdim) {
		//collided with edge
	} else if(newLocClass == 'snake') {
		//collided with self
	} else { 
		if(newLocClass != 'food')
			//did not eat food, move normally
			setGrid(snakeX.pop()+'-'+snakeY.pop(), 'ground');
		else {
			//ate food -> increase speed, and make another food
			speed = Math.floor(9/10*speed);
			makeFood();
		}

		//set new position
		setGrid(newX+'-'+newY, 'snake');
		snakeX.unshift(newX);
		snakeY.unshift(newY);

		//call another update
		tid = setTimeout(update, speed);
	}
}

//called to stop update
function stop() {
	clearTimeout(tid);
}

//Catch input
// document.onkeydown = function(e){
// 	switch(e.keyCode) {
// 		case 37: //left arrow
// 			if(dir != 2) dir = 0;
// 			break;
// 		case 38: //up arrow
// 			if(dir != 3) dir = 1;
// 			break;
// 		case 39: //right arrow
// 			if(dir != 0) dir = 2;
// 			break;
// 		case 40: //down arrow
// 			if(dir != 1) dir = 3;
// 			break;
// 	}
// };

</script>

<html>
<head>
<title>JavaSnake</title>
</head>
<body>
<table id="grid" />
</body>
</html>